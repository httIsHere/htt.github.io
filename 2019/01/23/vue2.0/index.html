<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="referrer" content="no-referrer" />

    <meta name="author" content="httishere">





<title>vue source code 2.0 | HTTISHERE</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.2.0"></head>
<body>
    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">HTTISHERE&#39;s Blog</a>
      </div>
      <div class="menu navbar-right">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/category">Categories</a>
        
        <a class="menu-item" href="/tag">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
        <a
          href="javascript:;"
          rel="sidebar"
          style="margin-left: 20px;"
          onclick="addFav();"
          >ğŸŒŸ Bookmark</a
        >
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">HTTISHERE&#39;s Blog</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>
        <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
      </div>
      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/category">Categories</a>
        
        <a class="menu-item" href="/tag">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };
  function addFav() {
    var title = document.title;
    var URL = document.URL;
    try {
      window.external.addFavorite(URL, title);
    } catch (e) {
      try {
        window.sidebar.addPanel(title, URL, "");
      } catch (e) {
        alert("ç”±äºæµè§ˆå™¨çš„å®‰å…¨è®¾ç½®\nå¯ä»¥ä½¿ç”¨Ctrl+Dæˆ–è€…Command+Dè¿›è¡Œæ‰‹åŠ¨æ”¶è—");
      }
    }
  }
</script>

        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">vue source code 2.0</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">httishere</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">ä¸€æœˆ 23, 2019&nbsp;&nbsp;10:30:23</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/vue/">vue</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="Vue-options"><a href="#Vue-options" class="headerlink" title="Vue options"></a>Vue options</h2><p>æ ¸å¿ƒä»£ç -&gt;core/indexï¼Œæš´éœ²ä¸€ä¸ªVueç±»ï¼ˆcore/instance/indexï¼‰ï¼Œåœ¨è¯¥æ–‡ä»¶å†…å‘ç°åˆå§‹å®šä¹‰äº†ä¸€ä¸ªVueï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Vue (options) &#123;</span><br><span class="line">  if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39; &amp;&amp;</span><br><span class="line">    !(this instanceof Vue)</span><br><span class="line">  ) &#123;</span><br><span class="line">    warn(&#39;Vue is a constructor and should be called with the &#96;new&#96; keyword&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">  this._init(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ä¼ å…¥çš„å‚æ•°optionsï¼Œå³æˆ‘å¦ˆå®ä¾‹åŒ–Vueå¯¹è±¡æ—¶ä¼ å…¥çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    el: &#39;#data&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†å®šä¹‰å®Œè¿™ä¸ªVueç±»ä¹‹åæ‰§è¡Œäº†5ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>initMixin(Vue)<br>ä¸»è¦ä¸ºVueåŸå‹å®šä¹‰äº†<code>_init</code>æ–¹æ³•ï¼Œå†å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œ<code>_init</code>æ–¹æ³•ï¼Œå…¶ä¸­å…ˆå¯¹optionsè¿›è¡Œäº†åˆ¤æ–­ï¼Œè‹¥éç»„ä»¶åˆ™ä¼šè¿›å…¥<code>mergeOptions</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯å°†<code>resolveConstructorOptions(vm.constructor)</code>å’Œ<code>options</code>åˆåœ¨ä¸€èµ·ã€‚<br>é‚£<code>resolveConstructorOptions</code>æ—¶å¹²å˜›çš„å‘¢ï¼Œ<code>Ctor.super</code>å¯æƒ³è€ŒçŸ¥æ˜¯ä¸Šçº§ï¼Œæ‰€ä»¥ä¸»è¦æ˜¯æ¥åˆ¤æ–­è¯¥ç±»æ˜¯å¦ä¸ºVueçš„å­ç±»ï¼Œè¿›è€Œåˆ¤æ–­çˆ¶ç±»ä¸­çš„optionsæœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå½“Vueæ··å…¥ä¸€äº›optionsæ—¶<code>superOptions</code>ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¹‹åå°±ä¼šæ›´æ–°å­ç±»çš„<code>superOptions</code>ï¼ŒVueæ··å…¥optionsçš„æƒ…å†µï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vue.extend(options)</span><br><span class="line">Vue.mixin(options)</span><br></pre></td></tr></table></figure>
åœ¨<code>mergeOptions</code>æ ¹æ®ä¸åŒçš„keyé‡‡ç”¨ä¸åŒçš„mergeç­–ç•¥ï¼Œueæä¾›äº†ä¸€ä¸ªstratså¯¹è±¡ï¼Œå…¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªhookï¼Œå¦‚æœstratsæœ‰æä¾›ç‰¹æ®Šçš„é€»è¾‘ï¼Œå°±èµ°stratsï¼Œå¦åˆ™èµ°é»˜è®¤mergeé€»è¾‘ï¼Œèƒ½å¾ˆå¥½çš„åŒºåˆ†å¯¹å¾…å…¬å…±å¤„ç†é€»è¾‘ä¸ç‰¹æ®Šå¤„ç†é€»è¾‘ã€‚<br><code>initMixin</code>å°±æ˜¯æŠŠä¸šåŠ¡é€»è¾‘ä»¥åŠç»„ä»¶çš„ä¸€äº›ç‰¹æ€§å…¨éƒ½æ”¾åˆ°äº†vm.$optionsä¸­äº†ï¼Œåç»­çš„æ“ä½œæˆ‘ä»¬éƒ½å¯ä»¥ä»vm.$optionsæ‹¿åˆ°å¯ç”¨çš„ä¿¡æ¯ï¼Œåç»­åŠ¨æ€æ·»åŠ ä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥è§„èŒƒçš„æ”¶å…¥åˆ°<code>vm.$options</code>å†…ã€‚<br>åç»­çš„æ‰§è¡Œï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">initLifecycle(vm)</span><br><span class="line">initEvents(vm)</span><br><span class="line">initRender(vm)</span><br><span class="line">callHook(vm, &#39;beforeCreate&#39;)</span><br><span class="line">initInjections(vm)</span><br><span class="line">initState(vm)</span><br><span class="line">initProvide(vm)</span><br><span class="line">callHook(vm, &#39;created&#39;)</span><br></pre></td></tr></table></figure>
éœ€è¦å…ˆäº†è§£å“åº”å¼æ•°æ®åŸç†ï¼ˆè®¢é˜…-å‘å¸ƒæ¨¡å¼ï¼‰ï¼š<br><img src="https://camo.githubusercontent.com/f60a57d4d89744f5947ca53c6ce80d3105171185/687474703a2f2f696d672e736f756368652e636f6d2f6632652f38613963383033353763623834626161653532383564653437663461656165622e706e67"></li>
</ul>
<h4 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">export class Observer &#123;</span><br><span class="line">  value: any;</span><br><span class="line">  dep: Dep;</span><br><span class="line">  vmCount: number; &#x2F;&#x2F; number of vms that have this object as root $data</span><br><span class="line"></span><br><span class="line">  constructor (value: any) &#123;</span><br><span class="line">    this.value &#x3D; value</span><br><span class="line">    this.dep &#x3D; new Dep()</span><br><span class="line">    this.vmCount &#x3D; 0</span><br><span class="line">    def(value, &#39;__ob__&#39;, this)</span><br><span class="line">    if (Array.isArray(value)) &#123;</span><br><span class="line">      if (hasProto) &#123;</span><br><span class="line">        protoAugment(value, arrayMethods)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">      &#125;</span><br><span class="line">      this.observeArray(value)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Walk through all properties and convert them into</span><br><span class="line">   * getter&#x2F;setters. This method should only be called when</span><br><span class="line">   * value type is Object.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  walk (obj: Object) &#123;</span><br><span class="line">    const keys &#x3D; Object.keys(obj)</span><br><span class="line">    for (let i &#x3D; 0; i &lt; keys.length; i++) &#123;</span><br><span class="line">      defineReactive(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Observe a list of Array items.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  observeArray (items: Array&lt;any&gt;) &#123;</span><br><span class="line">    for (let i &#x3D; 0, l &#x3D; items.length; i &lt; l; i++) &#123;</span><br><span class="line">      observe(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å®ä¾‹åŒ–Observerå¯¹è±¡æ—¶ï¼Œä¼šæ‰§è¡Œ<code>walk</code>è¿™ä¸ªæ–¹æ³•, ä¸»è¦æ˜¯éå†objå±æ€§, ç„¶åé€šè¿‡<code>Object.defineProperty</code>æ¥å®šä¹‰å“åº”å¼æ•°æ®ã€‚<br>defineReactive: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export function defineReactive (</span><br><span class="line"> obj: Object,</span><br><span class="line"> key: string,</span><br><span class="line"> val: any,</span><br><span class="line"> customSetter?: ?Function,</span><br><span class="line"> shallow?: boolean</span><br><span class="line">) &#123;</span><br><span class="line">  const dep &#x3D; new Dep() &#x2F;&#x2F; è®¢é˜…å™¨</span><br><span class="line">  ...</span><br><span class="line">  Object.defineProperty(obj, key, &#123;</span><br><span class="line">      ...</span><br><span class="line">      get: function reactiveGetter () &#123;</span><br><span class="line">        ...</span><br><span class="line">        dep.depend()</span><br><span class="line">        ...</span><br><span class="line">        return value</span><br><span class="line">      &#125;,</span><br><span class="line">      set: function reactiveSetter (newVal) &#123;</span><br><span class="line">        ...</span><br><span class="line">        dep.notify()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯åšäº†Depçš„ä¸¤ä¸ªæ“ä½œ: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dep.depend()</span><br><span class="line">dep.notify()</span><br></pre></td></tr></table></figure>
<p>Domä¸Šé€šè¿‡æŒ‡ä»¤æˆ–è€…åŒå¤§æ‹¬å·ç»‘å®šçš„æ•°æ®, ä¼šæ·»åŠ è§‚å¯Ÿè€…<code>watcher</code>, å½“å®ä¾‹åŒ–Watcherçš„æ—¶å€™ ä¼šè§¦å‘å±æ€§çš„getteræ–¹æ³•ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨dep.depend()ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">depend () &#123;</span><br><span class="line">  if (Dep.target) &#123;</span><br><span class="line">    Dep.target.addDep(this)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿›è¡ŒWatcherå®ä¾‹åŒ–æ—¶ä¼šè°ƒç”¨å†…éƒ¨getå‡½æ•°, ä¸ºå…¶åˆå§‹åŒ–:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get () &#123;</span><br><span class="line">  pushTarget(this) &#x2F;&#x2F; å°±æ˜¯ä¸ºDep.targetç»‘å®šæ­¤watcherå®ä¾‹</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ›´æ–°dataçš„æ—¶å€™, ä¼šè§¦å‘setæ–¹æ³•, æ‰§è¡Œdep.notify()å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">notify () &#123;</span><br><span class="line">  &#x2F;&#x2F; stabilize the subscriber list first</span><br><span class="line">  const subs &#x3D; this.subs.slice()</span><br><span class="line">  for (let i &#x3D; 0, l &#x3D; subs.length; i &lt; l; i++) &#123;</span><br><span class="line">    subs[i].update()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°±æ˜¯éå†depä¸­æ”¶é›†åˆ°çš„watcherå®ä¾‹ï¼Œè¿›è¡Œupdate()ã€‚ä¹Ÿå°±æ˜¯è¿›è¡Œæ•°æ®æ›´æ–°æ“ä½œã€‚è¿™ä¹Ÿå°±æ˜¯ç®€å•çš„æ•°æ®å“åº”å¼ã€‚<br>å…¶å®è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼š å½“æ•°æ®çš„getterè§¦å‘åï¼Œä¼šæ”¶é›†ä¾èµ–ï¼Œä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„è§¦å‘æ–¹å¼éƒ½ä¼šæ”¶é›†ä¾èµ–ï¼Œåªæœ‰é€šè¿‡watcherè§¦å‘çš„getterä¼šæ”¶é›†ä¾èµ–ï¼š<code>if (Dep.target) &#123; dep.depend() &#125;</code>ï¼Œè€Œæ‰€è°“çš„è¢«æ”¶é›†çš„ä¾èµ–å°±æ˜¯å½“å‰watcherï¼ŒDOMä¸­çš„æ•°æ®å¿…é¡»é€šè¿‡watcheræ¥ç»‘å®šï¼Œåªé€šè¿‡watcheræ¥è¯»å–ã€‚</p>
<h4 id="initLifecycle"><a href="#initLifecycle" class="headerlink" title="initLifecycle"></a>initLifecycle</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">export function initLifecycle (vm: Component) &#123;</span><br><span class="line">  const options &#x3D; vm.$options</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * è¿™é‡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨çˆ¶ç¤ºä¾‹ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™é€šè¿‡ while å¾ªç¯ï¼Œå»ºç«‹æ‰€æœ‰ç»„å»ºçš„çˆ¶å­å…³ç³»</span><br><span class="line">   *&#x2F;</span><br><span class="line">  let parent &#x3D; options.parent</span><br><span class="line">  if (parent &amp;&amp; !options.abstract) &#123;</span><br><span class="line">    while (parent.$options.abstract &amp;&amp; parent.$parent) &#123;</span><br><span class="line">      parent &#x3D; parent.$parent</span><br><span class="line">    &#125;</span><br><span class="line">    parent.$children.push(vm)</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * ä¸ºç»„ä»¶å®ä¾‹æŒ‚è½½ç›¸åº”å±æ€§ï¼Œå¹¶åˆå§‹åŒ–</span><br><span class="line">   *&#x2F;</span><br><span class="line">  vm.$parent &#x3D; parent</span><br><span class="line">  vm.$root &#x3D; parent ? parent.$root : vm</span><br><span class="line"></span><br><span class="line">  vm.$children &#x3D; []</span><br><span class="line">  vm.$refs &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">  vm._watcher &#x3D; null</span><br><span class="line">  vm._inactive &#x3D; null</span><br><span class="line">  vm._directInactive &#x3D; false</span><br><span class="line">  vm._isMounted &#x3D; false</span><br><span class="line">  vm._isDestroyed &#x3D; false</span><br><span class="line">  vm._isBeingDestroyed &#x3D; false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="initEvents"><a href="#initEvents" class="headerlink" title="initEvents"></a>initEvents</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export function initEvents (vm: Component) &#123;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * åˆ›å»ºäº‹ä»¶å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨äº‹ä»¶</span><br><span class="line">   *&#x2F;</span><br><span class="line">  vm._events &#x3D; Object.create(null)</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * è¿™é‡Œåº”è¯¥æ˜¯ç³»ç»Ÿäº‹ä»¶æ ‡è¯†ä½</span><br><span class="line">   *&#x2F;</span><br><span class="line">  vm._hasHookEvent &#x3D; false</span><br><span class="line">  &#x2F;&#x2F; init parent attached events</span><br><span class="line">  &#x2F;&#x2F; _parentListenerså…¶å®æ˜¯çˆ¶ç»„ä»¶æ¨¡æ¿ä¸­å†™çš„v-on</span><br><span class="line">  &#x2F;&#x2F; æ‰€ä»¥ä¸‹é¢è¿™æ®µå°±æ˜¯å°†çˆ¶ç»„ä»¶æ¨¡æ¿ä¸­æ³¨å†Œçš„äº‹ä»¶æ”¾åˆ°å½“å‰ç»„ä»¶å®ä¾‹çš„listenersé‡Œé¢</span><br><span class="line">  const listeners &#x3D; vm.$options._parentListeners</span><br><span class="line">  if (listeners) &#123;</span><br><span class="line">    updateComponentListeners(vm, listeners)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="initRender"><a href="#initRender" class="headerlink" title="initRender"></a>initRender</h4><p>ä¸»è¦æ˜¯ä¸ºç»„ä»¶å®ä¾‹ï¼Œåˆå§‹åŒ–ä¸€äº›æ¸²æŸ“å±æ€§ï¼Œæ¯”å¦‚$slotså’Œ$createElementç­‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">export function initRender (vm: Component) &#123;</span><br><span class="line">  vm._vnode &#x3D; null &#x2F;&#x2F; the root of the child tree</span><br><span class="line">  const options &#x3D; vm.$options</span><br><span class="line">  const parentVnode &#x3D; vm.$vnode &#x3D; options._parentVnode &#x2F;&#x2F; the placeholder node in parent tree</span><br><span class="line">  const renderContext &#x3D; parentVnode &amp;&amp; parentVnode.context</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; å¤„ç†ç»„ä»¶slotï¼Œè¿”å›slotæ’æ§½å¯¹è±¡</span><br><span class="line"></span><br><span class="line">  vm.$slots &#x3D; resolveSlots(options._renderChildren, renderContext)</span><br><span class="line">  vm.$scopedSlots &#x3D; emptyObject</span><br><span class="line"></span><br><span class="line">  vm._c &#x3D; (a, b, c, d) &#x3D;&gt; createElement(vm, a, b, c, d, false)</span><br><span class="line"></span><br><span class="line">  vm.$createElement &#x3D; (a, b, c, d) &#x3D;&gt; createElement(vm, a, b, c, d, true)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * å®šä¹‰v2.4ä¸­æ–°å¢çš„$attrsåŠ$listenerså±æ€§ï¼Œéœ€è¦ä¸ºå…¶ç»‘å®šå“åº”å¼æ•°æ®æ›´æ–°</span><br><span class="line">   *&#x2F;</span><br><span class="line">   </span><br><span class="line">  const parentData &#x3D; parentVnode &amp;&amp; parentVnode.data</span><br><span class="line"></span><br><span class="line">  &#x2F;* istanbul ignore else *&#x2F;</span><br><span class="line">  if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">    defineReactive(vm, &#39;$attrs&#39;, parentData &amp;&amp; parentData.attrs || emptyObject, () &#x3D;&gt; &#123;</span><br><span class="line">      !isUpdatingChildComponent &amp;&amp; warn(&#96;$attrs is readonly.&#96;, vm)</span><br><span class="line">    &#125;, true)</span><br><span class="line">    defineReactive(vm, &#39;$listeners&#39;, options._parentListeners || emptyObject, () &#x3D;&gt; &#123;</span><br><span class="line">      !isUpdatingChildComponent &amp;&amp; warn(&#96;$listeners is readonly.&#96;, vm)</span><br><span class="line">    &#125;, true)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    defineReactive(vm, &#39;$attrs&#39;, parentData &amp;&amp; parentData.attrs || emptyObject, null, true)</span><br><span class="line">    defineReactive(vm, &#39;$listeners&#39;, options._parentListeners || emptyObject, null, true)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="callHook"><a href="#callHook" class="headerlink" title="callHook"></a>callHook</h4><p>è°ƒç”¨é’©å­å‡½æ•°çš„æ–¹æ³•ï¼Œå³è§¦å‘ä¹‹å‰optionsä¸­å®šä¹‰çš„ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚<br>è¿›è¡Œåˆ°æ­¤å¤„ä¾¿å¼€å§‹è°ƒç”¨äº†beforeCreateé’©å­å‡½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function callHook (vm: Component, hook: string) &#123;</span><br><span class="line">  const handlers &#x3D; vm.$options[hook]</span><br><span class="line">  if (handlers) &#123;</span><br><span class="line">    for (let i &#x3D; 0, j &#x3D; handlers.length; i &lt; j; i++) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        handlers[i].call(vm)</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        handleError(e, vm, &#96;$&#123;hook&#125; hook&#96;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (vm._hasHookEvent) &#123;</span><br><span class="line">    vm.$emit(&#39;hook:&#39; + hook)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="initInjections-å’Œ-initProvide"><a href="#initInjections-å’Œ-initProvide" class="headerlink" title="initInjections å’Œ initProvide"></a>initInjections å’Œ initProvide</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">export function initInjections (vm: Component) &#123;</span><br><span class="line">  &#x2F;&#x2F; å› ä¸ºå¹¶æ²¡æœ‰vm._providedæ­¤æ—¶result è¿”å›çš„æ˜¯ä¸ª nullï¼Œä¹Ÿå°±æ²¡æœ‰è¿›è¡ŒdefineReactive</span><br><span class="line">  const result &#x3D; resolveInject(vm.$options.inject, vm)</span><br><span class="line">  if (result) &#123;</span><br><span class="line">    observerState.shouldConvert &#x3D; false</span><br><span class="line">    Object.keys(result).forEach(key &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;* istanbul ignore else *&#x2F;</span><br><span class="line">      if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">        defineReactive(vm, key, result[key], () &#x3D;&gt; &#123;</span><br><span class="line">          warn(</span><br><span class="line">            &#96;Avoid mutating an injected value directly since the changes will be &#96; +</span><br><span class="line">            &#96;overwritten whenever the provided component re-renders. &#96; +</span><br><span class="line">            &#96;injection being mutated: &quot;$&#123;key&#125;&quot;&#96;,</span><br><span class="line">            vm</span><br><span class="line">          )</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        defineReactive(vm, key, result[key])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    observerState.shouldConvert &#x3D; true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export function initProvide (vm: Component) &#123;</span><br><span class="line">  const provide &#x3D; vm.$options.provide</span><br><span class="line">  if (provide) &#123;</span><br><span class="line">    vm._provided &#x3D; typeof provide &#x3D;&#x3D;&#x3D; &#39;function&#39;</span><br><span class="line">      ? provide.call(vm)</span><br><span class="line">      : provide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="initState"><a href="#initState" class="headerlink" title="initState"></a>initState</h4><p>ä¸»è¦æ˜¯å®šä¹‰çš„æ•°æ®è¿›è¡ŒdefineReactiveã€‚</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>httishere</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://httishere.github.io/2019/01/23/vue2.0/">https://httishere.github.io/2019/01/23/vue2.0/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2021 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/"># ä»å…¥é—¨åˆ°æ”¾å¼ƒ</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/01/23/js%E7%BB%91%E5%AE%9A/">jsç»‘å®šcall, apply, bind</a>
            
            
            <a class="next" rel="next" href="/2019/01/22/vue1.0/">vue source code 1.0</a>
            
        </section>
        
            <link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css">
<div id="gitalk-container" style="margin-top: 50px;"></div>
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script src="https://priesttomb.github.io/js/md5.min.js"></script>
<script type="text/javascript">
    new Gitalk({
        clientID: '',
        clientSecret: '',
        id: window.location.pathname,
        repo: 'httIsHere.github.io',
        owner: 'httishere',
        admin: 'httishere',
        id: md5(location.pathname),
        distractionFreeMode: true
    }).render('gitalk-container')
</script>
        

    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© httishere | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
